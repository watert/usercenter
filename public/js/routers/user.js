// Generated by CoffeeScript 1.8.0
(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define(["backbone", "models/user", "bootstrap"], function(Backbone, User) {
    var BaseView, ProfileView, RegionView, SignView, UserRouter, formData;
    UserRouter = (function(_super) {
      __extends(UserRouter, _super);

      function UserRouter() {
        return UserRouter.__super__.constructor.apply(this, arguments);
      }

      UserRouter.prototype.initialize = function(o) {
        this.region = new RegionView({
          el: o.el
        });
        this.user = new User;
        this.user.on("login", (function(_this) {
          return function() {
            return _this.navigate("user/profile", {
              trigger: true
            });
          };
        })(this));
        return console.debug(this.region);
      };

      UserRouter.prototype.routes = {
        "user/": function() {
          return this.navigate("user/sign", {
            replace: true,
            trigger: true
          });
        },
        "user/sign": "signPage",
        "user/profile": function() {
          var profile;
          if (this.user.isLogin) {
            profile = new ProfileView({
              model: this.user
            });
            return this.region.load(profile);
          } else {
            return this.navigate("user/sign", {
              replace: true,
              trigger: true
            });
          }
        }
      };

      UserRouter.prototype.signPage = function() {
        var signPage;
        console.debug("index");
        signPage = new SignView({
          model: this.user
        });
        this.region.load(signPage);
        return console.debug("region load signPage");
      };

      return UserRouter;

    })(Backbone.Router);
    formData = function($form) {
      return _.object(_.map($form.find("input, select"), function(el) {
        var $input;
        $input = $(el);
        return [$input.attr("name"), $input.val()];
      }));
    };
    BaseView = (function(_super) {
      __extends(BaseView, _super);

      function BaseView() {
        return BaseView.__super__.constructor.apply(this, arguments);
      }

      BaseView.prototype.render = function() {
        var data, _ref;
        data = ((_ref = this.model) != null ? _ref.toJSON() : void 0) || {};
        this.$el.html(this.tmpl(data));
        this.trigger("render");
        return typeof this.onRender === "function" ? this.onRender() : void 0;
      };

      return BaseView;

    })(Backbone.View);
    RegionView = (function(_super) {
      __extends(RegionView, _super);

      function RegionView() {
        return RegionView.__super__.constructor.apply(this, arguments);
      }

      RegionView.prototype.tagName = "div";

      RegionView.prototype.load = function(view) {
        var _ref;
        if ((_ref = this.currentView) != null) {
          _ref.remove();
        }
        this.$el.append(view.$el);
        this.currentView = view;
        return view.render();
      };

      return RegionView;

    })(BaseView);
    ProfileView = (function(_super) {
      __extends(ProfileView, _super);

      function ProfileView() {
        return ProfileView.__super__.constructor.apply(this, arguments);
      }

      ProfileView.prototype.tmpl = _.template("<div class=\"container\">\n	<div class=\"row\">\n		<div class=\"col-sm-6 col-sm-offset-3\">\n			<div class=\"text-center\"> \n				<h1 class=\"avatar\">\n					<i class=\"fa fa-user\"></i>\n				</h1>\n				<p><%=name%><br>\n					<small class=\"text-muted\"> <%=email%></small>\n				</p>\n				<br>\n				<p><%=profile%></p>\n			</div>\n		</div>\n	</div>\n</div>			");

      return ProfileView;

    })(BaseView);
    SignView = (function(_super) {
      __extends(SignView, _super);

      function SignView() {
        return SignView.__super__.constructor.apply(this, arguments);
      }

      SignView.prototype.tagName = "div";

      SignView.prototype.events = {
        "submit #login": function(e) {
          var $form, data;
          e.preventDefault();
          $form = $(e.target);
          data = formData($form);
          return this.model.login(data);
        },
        "submit #signup": function(e) {
          var $form, data;
          e.preventDefault();
          $form = $(e.target);
          data = formData($form);
          this.model.signUp(data);
          return console.debug("signup", data, e.target);
        }
      };

      SignView.prototype.initialize = function(options) {
        SignView.__super__.initialize.call(this, options);
        console.debug(this.model);
        return this.model != null ? this.model : this.model = new User;
      };

      SignView.prototype.onRender = function() {
        return this.$(".nav-tabs a").click(function() {
          return $(this).tab("show");
        }).first().click();
      };

      SignView.prototype.tmpl = _.template("<div class=\"container\">\n	<div class=\"row\">\n		<div class=\"col-sm-6 col-sm-offset-3\">\n\n			<div class=\"panel panel-auth\">\n				<div class=\"panel-body\">\n					<ul class=\"nav nav-tabs\">\n						<li class=\"\"><a href=\"#login\" data-toggle=\"tab\">Login</a></li>\n						<li><a href=\"#signup\" data-toggle=\"tab\">Sign Up</a></li>\n					</ul>\n					<div class=\"tab-content\">\n						<div class=\"tab-pane\" id=\"login\">\n							<form action=\"login\" class=\"form\">\n								<div class=\"form-group\">\n									<label class=\"input-group\">\n										<span class=\"input-group-addon\"> \n											<i class=\"glyphicon glyphicon-envelope\"></i>\n											Email </span>\n										<input type=\"email\" name=\"email\" class=\"form-control\">\n									</label>\n								</div>\n								<div class=\"form-group\">\n									<label class=\"input-group\">\n										<span class=\"input-group-addon\"> \n											<i class=\"glyphicon glyphicon-asterisk\"></i>\n											Password </span>\n										<input type=\"password\" name=\"password\" class=\"form-control\">\n									</label>\n								</div>\n								<div class=\"form-actions\">\n									<button class=\"btn btn-login btn-primary\">Login</button>\n								</div>\n							</form>\n						</div>\n						<div class=\"tab-pane\" id=\"signup\">\n							<form action=\"login\" class=\"form\">\n								<div class=\"form-group\">\n									<label class=\"input-group\">\n										<span class=\"input-group-addon\"> \n											<i class=\"glyphicon glyphicon-user\"></i>\n											User </span>\n										<input type=\"text\" name=\"user\" class=\"form-control\">\n									</label>\n								</div>\n								<div class=\"form-group\">\n									<label class=\"input-group\">\n										<span class=\"input-group-addon\"> \n											<i class=\"glyphicon glyphicon-envelope\"></i>\n											Email </span>\n										<input type=\"email\" name=\"email\" class=\"form-control\">\n									</label>\n								</div>\n								<div class=\"form-group\">\n									<label class=\"input-group\">\n										<span class=\"input-group-addon\"> \n											<i class=\"glyphicon glyphicon-asterisk\"></i>\n											Password </span>\n										<input type=\"password\" name=\"password\" class=\"form-control\">\n									</label>\n								</div>\n\n									<button class=\"btn btn-signup btn-primary\">Sign Up</button>\n								</div>\n							</form>\n						</div>\n					</div>\n				</div>\n			</div>\n\n		</div>\n	</div>\n</div>");

      return SignView;

    })(BaseView);
    return UserRouter;
  });

}).call(this);

//# sourceMappingURL=user.js.map
